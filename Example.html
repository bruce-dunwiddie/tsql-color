<html>
<body>
<span style="font-family:consolas;">
<span style="color: Blue;">USE</span>&nbsp;<span style="color: Black;">[AdventureWorks2014]</span><br/>
<span style="color: Blue;">GO</span><br/>
<span style="color: Green;">/******&nbsp;Object:&nbsp;&nbsp;StoredProcedure&nbsp;[dbo].[uspSearchCandidateResumes]&nbsp;&nbsp;&nbsp;&nbsp;Script&nbsp;Date:&nbsp;11/26/2015&nbsp;9:21:50&nbsp;PM&nbsp;******/</span><br/>
<span style="color: Blue;">SET</span>&nbsp;<span style="color: Blue;">ANSI_NULLS</span>&nbsp;<span style="color: Blue;">ON</span><br/>
<span style="color: Blue;">GO</span><br/>
<span style="color: Blue;">SET</span>&nbsp;<span style="color: Blue;">QUOTED_IDENTIFIER</span>&nbsp;<span style="color: Blue;">ON</span><br/>
<span style="color: Blue;">GO</span><br/>
<br/>
<span style="color: Green;">--A&nbsp;stored&nbsp;procedure&nbsp;which&nbsp;demonstrates&nbsp;integrated&nbsp;full&nbsp;text&nbsp;search</span><br/>
<br/>
<span style="color: Blue;">CREATE</span>&nbsp;<span style="color: Blue;">PROCEDURE</span>&nbsp;<span style="color: Black;">[dbo]</span><span style="color: Gray;">.</span><span style="color: Black;">[uspSearchCandidateResumes]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Black;">@searchString</span>&nbsp;<span style="color: Black;">[nvarchar]</span><span style="color: Gray;">(</span><span style="color: Black;">1000</span><span style="color: Gray;">)</span><span style="color: Gray;">,</span>&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Black;">@useInflectional</span>&nbsp;<span style="color: Black;">[bit]</span><span style="color: Gray;">=</span><span style="color: Black;">0</span><span style="color: Gray;">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Black;">@useThesaurus</span>&nbsp;<span style="color: Black;">[bit]</span><span style="color: Gray;">=</span><span style="color: Black;">0</span><span style="color: Gray;">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Black;">@language</span><span style="color: Black;">[int]</span><span style="color: Gray;">=</span><span style="color: Black;">0</span><br/>
<br/>
<br/>
<span style="color: Blue;">WITH</span>&nbsp;<span style="color: Blue;">EXECUTE</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Blue;">CALLER</span><br/>
<span style="color: Blue;">AS</span><br/>
<span style="color: Blue;">BEGIN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SET</span>&nbsp;<span style="color: Blue;">NOCOUNT</span>&nbsp;<span style="color: Blue;">ON</span><span style="color: Gray;">;</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">DECLARE</span>&nbsp;<span style="color: Black;">@string</span>&nbsp;<span style="color: Blue;">nvarchar</span><span style="color: Gray;">(</span><span style="color: Black;">1050</span><span style="color: Gray;">)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Green;">--setting&nbsp;the&nbsp;lcid&nbsp;to&nbsp;the&nbsp;default&nbsp;instance&nbsp;LCID&nbsp;if&nbsp;needed</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">IF</span>&nbsp;<span style="color: Black;">@language</span>&nbsp;<span style="color: Gray;">=</span>&nbsp;<span style="color: Gray;">NULL</span>&nbsp;<span style="color: Gray;">OR</span>&nbsp;<span style="color: Black;">@language</span>&nbsp;<span style="color: Gray;">=</span>&nbsp;<span style="color: Black;">0</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">BEGIN</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">@language</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Fuchsia;">CONVERT</span><span style="color: Gray;">(</span><span style="color: Blue;">int</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Fuchsia;">serverproperty</span><span style="color: Gray;">(</span><span style="color: Red;">&#39;lcid&#39;</span><span style="color: Gray;">)</span><span style="color: Gray;">)</span>&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">END</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Green;">--FREETEXTTABLE&nbsp;case&nbsp;as&nbsp;inflectional&nbsp;and&nbsp;Thesaurus&nbsp;were&nbsp;required</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">IF</span>&nbsp;<span style="color: Black;">@useThesaurus</span>&nbsp;<span style="color: Gray;">=</span>&nbsp;<span style="color: Black;">1</span>&nbsp;<span style="color: Gray;">AND</span>&nbsp;<span style="color: Black;">@useInflectional</span>&nbsp;<span style="color: Gray;">=</span>&nbsp;<span style="color: Black;">1</span>&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">BEGIN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[RANK]</span>&nbsp;<span style="color: Blue;">FROM</span>&nbsp;<span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">FT_TBL</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Gray;">INNER</span>&nbsp;<span style="color: Gray;">JOIN</span>&nbsp;<span style="color: Fuchsia;">FREETEXTTABLE</span><span style="color: Gray;">(</span><span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span><span style="color: Gray;">,</span><span style="color: Gray;">*</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Black;">@searchString</span><span style="color: Gray;">,</span><span style="color: Black;">LANGUAGE</span>&nbsp;<span style="color: Black;">@language</span><span style="color: Gray;">)</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">KEY_TBL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ON</span>&nbsp;&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[KEY]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">END</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ELSE</span>&nbsp;<span style="color: Blue;">IF</span>&nbsp;<span style="color: Black;">@useThesaurus</span>&nbsp;<span style="color: Gray;">=</span>&nbsp;<span style="color: Black;">1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">BEGIN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">@string</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Red;">&#39;FORMSOF(THESAURUS,&quot;&#39;</span><span style="color: Gray;">+</span><span style="color: Black;">@searchString</span>&nbsp;<span style="color: Gray;">+</span><span style="color: Red;">&#39;&quot;&#39;</span><span style="color: Gray;">+</span><span style="color: Red;">&#39;)&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[RANK]</span>&nbsp;<span style="color: Blue;">FROM</span>&nbsp;<span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">FT_TBL</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Gray;">INNER</span>&nbsp;<span style="color: Gray;">JOIN</span>&nbsp;<span style="color: Fuchsia;">CONTAINSTABLE</span><span style="color: Gray;">(</span><span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span><span style="color: Gray;">,</span><span style="color: Gray;">*</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Black;">@string</span><span style="color: Gray;">,</span><span style="color: Black;">LANGUAGE</span>&nbsp;<span style="color: Black;">@language</span><span style="color: Gray;">)</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">KEY_TBL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ON</span>&nbsp;&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[KEY]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">END</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ELSE</span>&nbsp;<span style="color: Blue;">IF</span>&nbsp;<span style="color: Black;">@useInflectional</span>&nbsp;<span style="color: Gray;">=</span>&nbsp;<span style="color: Black;">1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">BEGIN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">@string</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Red;">&#39;FORMSOF(INFLECTIONAL,&quot;&#39;</span><span style="color: Gray;">+</span><span style="color: Black;">@searchString</span>&nbsp;<span style="color: Gray;">+</span><span style="color: Red;">&#39;&quot;&#39;</span><span style="color: Gray;">+</span><span style="color: Red;">&#39;)&#39;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[RANK]</span>&nbsp;<span style="color: Blue;">FROM</span>&nbsp;<span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">FT_TBL</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Gray;">INNER</span>&nbsp;<span style="color: Gray;">JOIN</span>&nbsp;<span style="color: Fuchsia;">CONTAINSTABLE</span><span style="color: Gray;">(</span><span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span><span style="color: Gray;">,</span><span style="color: Gray;">*</span><span style="color: Gray;">,</span>&nbsp;<span style="color: Black;">@string</span><span style="color: Gray;">,</span><span style="color: Black;">LANGUAGE</span>&nbsp;<span style="color: Black;">@language</span><span style="color: Gray;">)</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">KEY_TBL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ON</span>&nbsp;&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[KEY]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">END</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ELSE</span>&nbsp;<span style="color: Green;">--base&nbsp;case,&nbsp;plain&nbsp;CONTAINSTABLE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">BEGIN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">@string</span><span style="color: Gray;">=</span><span style="color: Red;">&#39;&quot;&#39;</span><span style="color: Gray;">+</span><span style="color: Black;">@searchString</span>&nbsp;<span style="color: Gray;">+</span><span style="color: Red;">&#39;&quot;&#39;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">SELECT</span>&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span><span style="color: Gray;">,</span><span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[RANK]</span>&nbsp;<span style="color: Blue;">FROM</span>&nbsp;<span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">FT_TBL</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Gray;">INNER</span>&nbsp;<span style="color: Gray;">JOIN</span>&nbsp;<span style="color: Fuchsia;">CONTAINSTABLE</span><span style="color: Gray;">(</span><span style="color: Black;">[HumanResources]</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidate]</span><span style="color: Gray;">,</span><span style="color: Gray;">*</span><span style="color: Gray;">,</span><span style="color: Black;">@string</span><span style="color: Gray;">,</span><span style="color: Black;">LANGUAGE</span>&nbsp;<span style="color: Black;">@language</span><span style="color: Gray;">)</span>&nbsp;<span style="color: Blue;">AS</span>&nbsp;<span style="color: Black;">KEY_TBL</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">ON</span>&nbsp;&nbsp;<span style="color: Black;">FT_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[JobCandidateID]</span>&nbsp;<span style="color: Gray;">=</span><span style="color: Black;">KEY_TBL</span><span style="color: Gray;">.</span><span style="color: Black;">[KEY]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: Blue;">END</span><br/>
<br/>
<span style="color: Blue;">END</span><span style="color: Gray;">;</span><br/>
</span>
</body>
</html>
